import sys
import marshal

import encrypt_RSA
import NY_Encrypt

# Dynamic
import test

encrypt_RSA.create_key('key.public', 'key.private')

result = NY_Encrypt.createNY('test.py')
if result :
    public_key = encrypt_RSA.read_key('key.public')
    file = NY_Encrypt.NY('test.ny', public_key)
    print()
    print("#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#")
    print(file.body)
    print("#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#")
    print()

    module = NY_Encrypt.load('test', file.body)
    if module == None :
        print("%%%%%%%% ERROR %%%%%%%%")
    else :
        print()
        print("#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#")
        print(dir(module))
        print("#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#")
        print()
    
    moduleHandle = test.NYamMain()
    moduleHandle.init('.')
    print(moduleHandle.getMalwareList())
    print(moduleHandle.getModuleInformation())
    moduleHandle.uninit()
