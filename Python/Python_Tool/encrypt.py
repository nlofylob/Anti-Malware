import os
import sys
import hashlib
import zlib

def main() :

    # Command Line
    if len(sys.argv) != 2 :
        print('How to Use : encrypt.py [file]')
        exit(0)
    
    fName = sys.argv[1]

    fHandle = open(fName, 'rb')
    fBuf = fHandle.read()
    fHandle.close()

    # 1. Compress
    fCompressed = zlib.compress(fBuf)
    #print(fCompressed)

    # 2. Encrypt : XOR
    fEncrypted = ''
    for i in fCompressed :
        fEncrypted += chr(i ^ 0xFF)
    #print(fEncrypted)

    # Create File Format : ny - Header / Body
    HEADER = 'NYAM'
    BODY = fEncrypted

    # Create File Format : ny - ALL
    ny = HEADER + BODY
    fMD5x4 = ny
    for i in range(4) :
        md5 = hashlib.md5()
        md5.update(fMD5x4.encode('UTF-8'))
        fMD5x4 = md5.hexdigest()
    ny += fMD5x4

    fName_base = os.path.basename(fName)
    ny_name = fName_base.split('.')[0] + '.ny'
    fHandle = open(ny_name, 'wb')
    fHandle.write(ny.encode('UTF-8'))
    fHandle.close()

    print('[ Result : encrypt.py ] {before} => => => => {after}'.format(before = fName, after = ny_name))

if __name__ == '__main__' :
    main()
