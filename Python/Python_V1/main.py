import os
import sys
import hashlib

REMOVE = "../../Sample/remove"

#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#
MalwareDB = [
    '44d88612fea8a8f36de82e1278abb02f:EICAR',
    '4a3eacc01a5a18fa0164ef0428b4a109:TEST'
]
#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#

m_db = []

def CreateMalwareDB() :
    for pattern in MalwareDB :
        temp = []
        m = pattern.split(':')
        temp.append(m[0]) # Malware's MD5
        temp.append(m[1]) # Malware's Name
        m_db.append(temp)

def SearchMalwareDB(inputMD5) :
    for temp in m_db :
        # MD5
        if inputMD5 == temp[0] :
            return True, temp[1]
    
    return False, ''



if __name__ == '__main__' :
    CreateMalwareDB()

    # Command Line
    if len(sys.argv) != 2 :
        print ('How to Use : anti-malware.py [file]')
        exit(0)

    fName = sys.argv[1]

    fHandle = open(fName, 'rb')
    fBuf = fHandle.read()
    fHandle.close()

    md5 = hashlib.md5()
    md5.update(fBuf)
    fMD5 = md5.hexdigest()

    result, mName = SearchMalwareDB(fMD5)
    if result == True :
        print("[ Malware Detected ] {fileName} : {malwareName}".format(fileName = fName, malwareName = mName))
        print("( + ) Detected By MD5")
        #os.remove(REMOVE)
    else :
        print("[ PASS ] {fileName}".format(fileName = fName))



"""

# Signature
fileSignature = fileBuf[0:3]

if fileSignature == eicar_SIGNATURE :
    print("Malware - Detected By Signature")
    print(f'Malware Signature : ${fileSignature}')
    #os.remove(REMOVE)
else :
    print("Not Malware")
    print(f'File (Not Malware) Signature : ${fileSignature}')

#print(fileBuf)

"""
